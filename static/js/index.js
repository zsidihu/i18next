const cE=(a,b={})=>{const c=document.createElement(a);for(const[d,e]of Object.entries(b))c.setAttribute(d,e);return c},sleep=a=>new Promise(b=>setTimeout(b,a)),tout=50,load=document.getElementById("load"),form=document.getElementById("form"),apis="https://clients5.google.com/translate_a/t?",data={client:"dict-chrome-ex",sl:"auto",tl:"",q:""};for(let a in langs)form.sl.innerHTML+=`<option value="${a}">Source Language: ${langs[a]}</option>`,form.tl.innerHTML+=`<option value="${a}">Target Language: ${langs[a]}</option>`;let answer=null,mode="chrome";const groupRadio=document.querySelectorAll(".group-switch input"),captchaBox=document.getElementsByClassName("question")[0],captchaRow=captchaBox.children,setCaptcha=()=>{const c=Math.floor(10*Math.random())+1,a=Math.floor(10*Math.random())+1;answer=c+a,captchaRow[0].textContent=`What is ${c} + ${a}?`,captchaRow[1].value=""};setCaptcha();const closeBox=a=>{a.parentNode.classList.remove("visible")},progBar=document.querySelector(".progress-bar"),progBox=document.querySelector(".progress-box"),textFst=progBar.firstElementChild,textLst=progBox.firstElementChild;(function(a){progBar.style.width=a,textFst.style.width=a,textLst.style.width=a,progBar.style["max-width"]=a,textFst.style["max-width"]=a,textLst.style["max-width"]=a})(load.offsetWidth-50+"px");const setProgress=(a,b=0)=>{progBox.style.width=b+"%",textFst.textContent=b+"%",textLst.textContent=b+"%"},formatJson=(a,b="  ",c=0)=>{if("object"!=typeof a||null===a)return JSON.stringify(a);let d="{\n";for(const e in a)if(a.hasOwnProperty(e)){const f=a[e];d+=`${b.repeat(c+1)}"${e}": ${formatJson(f,b,c+1)},\n`}return d=d.replace(/,\n$/,"\n"),d+=b.repeat(c)+"}",d};form.addEventListener("submit",a=>{a.preventDefault();const b=a.submitter.name;if("upload"===b){const a=cE("input",{type:"file",accept:".json"});a.onchange=()=>{if(a.files[0]){const b=new FileReader;b.onload=a=>form.source.value=a.target.result,b.readAsText(a.files[0])}},a.click()}else if(!("download"===b))"translate"===b&&(setCaptcha(),captchaBox.classList.add("visible"));else if(0<form.target.value.length){const a=btoa(String.fromCharCode(...new TextEncoder().encode(form.target.value)));cE("a",{download:form.tl.value+".json",href:"data:application/json;charset=utf-8;base64,"+a}).click()}}),captchaRow[2].addEventListener("click",async()=>{if(parseInt(captchaRow[1].value)!==answer)return alert("Incorrect answer!\nPlease try again."),void setCaptcha();captchaBox.classList.remove("visible");try{const a=JSON.parse(form.source.value);let b=JSON.parse(form.source.value);if(form.sl.value===form.tl.value)return void alert("Same values in options!");load.classList.add("visible"),data.sl=form.sl.value,data.tl=form.tl.value;let c=0;const d=Object.keys(a).length;switch(mode){case"chrome":{for(let e in a){for(let c in a[e])if("message"==c){data.q=a[e][c];const d=apis+new URLSearchParams(data).toString(),f=await fetch(d).then(a=>a.json());b[e][c]="auto"===data.sl?f[0][0]:f[0]}setProgress(load,(100*(++c/d)).toFixed()),await sleep(tout)}break}case"flat":{for(let e in a){if("string"==typeof a[e]){data.q=a[e];const c=apis+new URLSearchParams(data).toString(),d=await fetch(c).then(a=>a.json());b[e]="auto"===data.sl?d[0][0]:d[0]}setProgress(load,(100*(++c/d)).toFixed()),await sleep(tout)}break}case"nested":{async function c(a){const b=Array.isArray(a)?[]:{};for(let d in a)if("string"==typeof a[d]){data.q=a[d];const c=apis+new URLSearchParams(data).toString(),e=await fetch(c).then(a=>a.json());b[d]="auto"===data.sl?e[0][0]:e[0],setProgress(load,(100*(++g/f)).toFixed()),await sleep(tout)}else b[d]="object"==typeof a[d]&&null!==a[d]?await c(a[d]):a[d];return b}let d=0;const e=a=>{for(let b in a)"string"==typeof a[b]?d++:"object"==typeof a[b]&&null!==a[b]&&e(a[b])};e(a);let f=d,g=0;b=await c(a);break}}load.classList.remove("visible"),form.target.value=formatJson(b,"  "),form.target.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>setProgress(load,0),500)}catch(a){alert("Translation error!\n"+a)}}),groupRadio.forEach(a=>{a.addEventListener("click",()=>{mode=a.id})}),form.target.addEventListener("input",()=>{form.download.disabled=""===form.target.value.trim()});
