const cE=(a,b={})=>{const c=document.createElement(a);for(const[d,e]of Object.entries(b))c.setAttribute(d,e);return c},load=document.getElementById("load"),form=document.getElementById("form"),apis="https://clients5.google.com/translate_a/t?",data={client:"dict-chrome-ex",sl:"auto",tl:"",q:""};for(let a in langs)form.sl.innerHTML+=`<option value="${a}">Source Language: ${langs[a]}</option>`,form.tl.innerHTML+=`<option value="${a}">Target Language: ${langs[a]}</option>`;let answer=null;const captchaBox=document.getElementsByClassName("question")[0],captchaRow=captchaBox.children,setCaptcha=()=>{const c=Math.floor(10*Math.random())+1,a=Math.floor(10*Math.random())+1;answer=c+a,captchaRow[0].textContent=`What is ${c} + ${a}?`,captchaRow[1].value=""};setCaptcha();const setProgress=(a,b=0)=>{a.setAttribute("data-percent",`${b}%`),a.style.setProperty("--left",`${b}%`),50>b?a.style.setProperty("--color","black"):50<b&&a.style.setProperty("--color","white")},formatJson=(a,b="  ",c=0)=>{if("object"!=typeof a||null===a)return JSON.stringify(a);let d="{\n";for(const e in a)if(a.hasOwnProperty(e)){const f=a[e];d+=`${b.repeat(c+1)}"${e}": ${formatJson(f,b,c+1)},\n`}return d=d.replace(/,\n$/,"\n"),d+=b.repeat(c)+"}",d};form.addEventListener("submit",a=>{a.preventDefault();const b=a.submitter.name;if("upload"===b){const a=cE("input",{type:"file",accept:".json"});a.onchange=()=>{if(a.files[0]){const b=new FileReader;b.onload=a=>form.source.value=a.target.result,b.readAsText(a.files[0])}},a.click()}else if(!("download"===b))"translate"===b&&(setCaptcha(),captchaBox.classList.add("visible"));else if(0<form.target.value.length){const a=btoa(String.fromCharCode(...new TextEncoder().encode(form.target.value)));cE("a",{download:form.tl.value+".json",href:"data:application/json;charset=utf-8;base64,"+a}).click()}}),captchaRow[2].addEventListener("click",async()=>{if(parseInt(captchaRow[1].value)!==answer)return alert("Incorrect answer!\nPlease try again."),void setCaptcha();captchaBox.classList.remove("visible");try{const a=JSON.parse(form.source.value),b=JSON.parse(form.source.value);if(form.sl.value===form.tl.value)return void alert("Same values in options!");load.classList.add("visible"),data.sl=form.sl.value,data.tl=form.tl.value;let c=0;const d=Object.keys(a).length;for(let e in a){for(let c in a[e])if("message"==c){data.q=a[e][c];const d=apis+new URLSearchParams(data).toString(),f=await fetch(d).then(a=>a.json());b[e][c]="auto"===data.sl?f[0][0]:f[0]}setProgress(load,(100*(++c/d)).toFixed())}load.classList.remove("visible"),form.target.value=formatJson(b,"  "),form.target.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>setProgress(load,0),500)}catch(a){alert("Translation error!\n"+a)}}),form.target.addEventListener("input",()=>{form.download.disabled=""===form.target.value.trim()});
