const cE=(a,b={})=>{const c=document.createElement(a);for(const[d,e]of Object.entries(b))c.setAttribute(d,e);return c},sleep=a=>new Promise(b=>setTimeout(b,a)),tout=50,load=document.getElementById("load"),form=document.getElementById("form"),isos=document.getElementById("isos"),apis="https://clients5.google.com/translate_a/t?",data={client:"dict-chrome-ex",sl:"auto",tl:"",q:""};for(let a in langs){const b=cE("option",{value:a}),c=cE("option",{value:a});if(b.textContent="Source Language: "+langs[a],c.textContent="Target Language: "+langs[a],form.sl.appendChild(b),form.tl.appendChild(c),"auto"!=a){const b=`lang_${a}`,c=cE("div"),d=cE("input",{id:b,type:"checkbox"}),e=cE("label",{for:b,title:langs[a]});d.addEventListener("input",()=>addLang(d,a)),e.textContent=a,c.appendChild(d),c.appendChild(e),isos.appendChild(c)}}let zip=null,summ=null,mode="chrome",dest=["auto"];const captcha=document.getElementById("captcha-box"),setMode=a=>mode=a,hideBox=a=>a.parentNode.classList.remove("visible"),fillBox=()=>{const d=document.getElementById("captcha-question"),e=document.getElementById("captcha-answer"),a=Math.floor(10*Math.random())+1,b=Math.floor(10*Math.random())+1;summ=a+b,d.textContent=`What is ${a} + ${b} ?`,e.value=""},addLang=(a,b)=>{a.checked?dest.push(b):dest=dest.filter(a=>a!==b)},testBox=async()=>{const c=document.getElementById("captcha-answer"),a=parseInt(c.value);if(a===summ)try{if(captcha.classList.remove("visible"),0<dest.length)if(1===dest.length){const a=JSON.parse(form.source.value),b=await doTranslate(a,form.sl.value,dest[0]);b&&(zip=null,form.target.value=b,form.download.disabled=!1,form.target.dispatchEvent(new Event("input",{bubbles:!0})))}else{const a=JSON.parse(form.source.value),b={};for(const c of dest)b[c]=await doTranslate(a,form.sl.value,c),await sleep(500);for(const a in zip=new JSZip,b)"chrome"===mode?zip.folder(a).file("messages.json",b[a],{binary:!1,compression:"DEFLATE"}):zip.file(a+".json",b[a],{binary:!1,compression:"DEFLATE"});form.target.value="",form.download.disabled=!1}}catch(a){alert("Translation error!\n"+a)}else fillBox()},progBar=document.querySelector(".progress-bar"),progBox=document.querySelector(".progress-box"),textFst=progBar.firstElementChild,textLst=progBox.firstElementChild;(function(a){progBar.style.width=a,textFst.style.width=a,textLst.style.width=a,progBar.style["max-width"]=a,textFst.style["max-width"]=a,textLst.style["max-width"]=a})(load.offsetWidth-50+"px");const setProgress=(a=0)=>{progBox.style.width=a+"%",textFst.textContent=a+"%",textLst.textContent=a+"%"},doTranslate=async(a,b,c)=>{try{let d=a,e=structuredClone(a);if(b===c)return alert("Same values in options!"),null;load.classList.add("visible"),data.sl=b,data.tl=c;let f=0,g=Object.keys(d).length;switch(mode){case"chrome":{for(let a in d){for(let b in d[a])if("message"==b){data.q=d[a][b];const c=apis+new URLSearchParams(data).toString(),f=await fetch(c).then(a=>a.json());e[a][b]="auto"===data.sl?f[0][0]:f[0]}setProgress((100*(++f/g)).toFixed()),await sleep(tout)}break}case"flat":{for(let a in d){if("string"==typeof d[a]){data.q=d[a];const b=apis+new URLSearchParams(data).toString(),c=await fetch(b).then(a=>a.json());e[a]="auto"===data.sl?c[0][0]:c[0]}setProgress((100*(++f/g)).toFixed()),await sleep(tout)}break}case"nested":{async function a(b){const c=Array.isArray(b)?[]:{};for(let d in b)if("string"==typeof b[d]){data.q=b[d];const a=apis+new URLSearchParams(data).toString(),e=await fetch(a).then(a=>a.json());c[d]="auto"===data.sl?e[0][0]:e[0],setProgress((100*(++g/f)).toFixed()),await sleep(tout)}else c[d]="object"==typeof b[d]&&null!==b[d]?await a(b[d]):b[d];return c}let b=0;const c=a=>{for(let d in a)"string"==typeof a[d]?b++:"object"==typeof a[d]&&null!==a[d]&&c(a[d])};c(d);let f=b,g=0;e=await a(d);break}}return load.classList.remove("visible"),setTimeout(()=>setProgress(),300),JSON.stringify(e,null,2)}catch(a){return alert("Translation error!\n"+a),null}};form.addEventListener("submit",a=>{a.preventDefault();const b=a.submitter.name;if("upload"===b){const a=cE("input",{type:"file",accept:".json"});a.onchange=()=>{if(a.files[0]){const b=new FileReader;b.onload=a=>form.source.value=a.target.result,b.readAsText(a.files[0])}},a.click()}else if(!("download"===b))"translate"===b&&(fillBox(),captcha.classList.add("visible"));else if(zip)zip.generateAsync({type:"base64"}).then(function(b){const c=cE("a",{download:"translations.zip",href:"data:application/zip;base64,"+b});document.body.appendChild(c),c.click(),c.remove()});else if(0<form.target.value.length){const b=btoa(String.fromCharCode(...new TextEncoder().encode(form.target.value))),c=cE("a",{download:form.tl.value+".json",href:"data:application/json;charset=utf-8;base64,"+b});document.body.appendChild(c),c.click(),c.remove()}}),form.multiple.addEventListener("click",()=>{form.multiple.checked?(form.tl.disabled=!0,form.target.disabled=!0,isos.classList.add("visible"),dest.length=0):(form.tl.disabled=!1,form.target.disabled=!1,isos.classList.remove("visible"),isos.querySelectorAll("input").forEach(a=>a.checked=!1),dest.length=0,dest.push(form.tl.value))}),form.tl.addEventListener("input",()=>dest[0]=form.tl.value),form.target.addEventListener("input",()=>form.download.disabled=""===form.target.value.trim());
