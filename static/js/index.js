const cE=(t,e={})=>{const o=document.createElement(t);for(const[t,a]of Object.entries(e))o.setAttribute(t,a);return o},sleep=t=>new Promise(e=>setTimeout(e,t)),tout=50,load=document.getElementById("load"),form=document.getElementById("form"),isos=document.getElementById("isos"),apis="https://clients5.google.com/translate_a/t?",data={client:"dict-chrome-ex",sl:"auto",tl:"",q:""};for(let t in langs){const e=cE("option",{value:t}),o=cE("option",{value:t});if(e.textContent="Source Language: "+langs[t],o.textContent="Target Language: "+langs[t],form.sl.appendChild(e),form.tl.appendChild(o),"auto"!==t){const e=`lang_${t}`,o=cE("div"),a=cE("input",{id:e,type:"checkbox"}),s=cE("label",{for:e,title:langs[t]});a.addEventListener("input",()=>addLang(a,t)),s.textContent=t,o.appendChild(a),o.appendChild(s),isos.appendChild(o)}}let zip=null,summ=null,mode="chrome",dest=["auto"];const captcha=document.getElementById("captcha-box"),setMode=t=>mode=t,hideBox=t=>t.parentNode.classList.remove("visible"),fillBox=()=>{const t=document.getElementById("captcha-question"),e=document.getElementById("captcha-answer"),o=Math.floor(10*Math.random())+1,a=Math.floor(10*Math.random())+1;summ=o+a,t.textContent=`What is ${o} + ${a} ?`,e.value=""},addLang=(t,e)=>{t.checked?dest.push(e):dest=dest.filter(t=>t!==e)},testBox=async()=>{const t=document.getElementById("captcha-answer");if(parseInt(t.value)===summ)try{if(captcha.classList.remove("visible"),dest.length>0)if(1===dest.length){const t=JSON.parse(form.source.value),e=await doTranslate(t,form.sl.value,dest[0]);e&&(zip=null,form.target.value=e,form.download.disabled=!1,form.target.dispatchEvent(new Event("input",{bubbles:!0})))}else{const t=JSON.parse(form.source.value),e={};for(const o of dest)e[o]=await doTranslate(t,form.sl.value,o),await sleep(500);zip=new JSZip;for(const t in e)"chrome"===mode?zip.folder(t).file("messages.json",e[t],{binary:!1,compression:"DEFLATE"}):zip.file(t+".json",e[t],{binary:!1,compression:"DEFLATE"});form.target.value="",form.download.disabled=!1}}catch(t){alert("Translation error!\n"+t)}else fillBox()},progBar=document.querySelector(".progress-bar"),progBox=document.querySelector(".progress-box"),textFst=progBar.firstElementChild,textLst=progBox.firstElementChild;!function(t){progBar.style.width=t,textFst.style.width=t,textLst.style.width=t,progBar.style["max-width"]=t,textFst.style["max-width"]=t,textLst.style["max-width"]=t}(load.offsetWidth-50+"px");const setProgress=(t=0)=>{progBox.style.width=t+"%",textFst.textContent=t+"%",textLst.textContent=t+"%"},doTranslate=async(t,e,o)=>{try{let a=t,s=structuredClone(t);if(e===o)return alert("Same values in options!"),null;load.classList.add("visible"),data.sl=e,data.tl=o;let n=0,r=Object.keys(a).length;switch(mode){case"chrome":for(let t in a){for(let e in a[t])if("message"===e){data.q=a[t][e];const o=apis+new URLSearchParams(data).toString(),n=await fetch(o).then(t=>t.json());s[t][e]="auto"===data.sl?n[0][0]:n[0]}setProgress((++n/r*100).toFixed()),await sleep(50)}break;case"flat":for(let t in a){if("string"==typeof a[t]){data.q=a[t];const e=apis+new URLSearchParams(data).toString(),o=await fetch(e).then(t=>t.json());s[t]="auto"===data.sl?o[0][0]:o[0]}setProgress((++n/r*100).toFixed()),await sleep(50)}break;case"nested":{let t=0;const countStrings=e=>{for(let o in e)"string"==typeof e[o]?t++:"object"==typeof e[o]&&null!==e[o]&&countStrings(e[o])};countStrings(a);let e=t,o=0;s=await async function translateNested(t){const a=Array.isArray(t)?[]:{};for(let s in t)if("string"==typeof t[s]){data.q=t[s];const n=apis+new URLSearchParams(data).toString(),r=await fetch(n).then(t=>t.json());a[s]="auto"===data.sl?r[0][0]:r[0],setProgress((++o/e*100).toFixed()),await sleep(50)}else"object"==typeof t[s]&&null!==t[s]?a[s]=await translateNested(t[s]):a[s]=t[s];return a}(a);break}}return load.classList.remove("visible"),setTimeout(()=>setProgress(),300),JSON.stringify(s,null,2)}catch(t){return alert("Translation error!\n"+t),null}};form.addEventListener("submit",t=>{t.preventDefault();const e=t.submitter.name;if("upload"===e){const t=cE("input",{type:"file",accept:".json"});t.onchange=()=>{if(t.files[0]){const e=new FileReader;e.onload=t=>form.source.value=t.target.result,e.readAsText(t.files[0])}},t.click()}else if("download"===e){if(zip)zip.generateAsync({type:"base64"}).then(function(t){const e=cE("a",{download:"translations.zip",href:"data:application/zip;base64,"+t});document.body.appendChild(e),e.click(),e.remove()});else if(form.target.value.length>0){const t="data:application/json;charset=utf-8;base64,"+btoa(String.fromCharCode(...(new TextEncoder).encode(form.target.value))),e=cE("a",{download:form.tl.value+".json",href:t});document.body.appendChild(e),e.click(),e.remove()}}else"translate"===e&&(fillBox(),captcha.classList.add("visible"))}),form.multiple.addEventListener("click",()=>{form.multiple.checked?(form.tl.disabled=!0,form.target.disabled=!0,isos.classList.add("visible"),dest.length=0):(form.tl.disabled=!1,form.target.disabled=!1,isos.classList.remove("visible"),isos.querySelectorAll("input").forEach(t=>t.checked=!1),dest.length=0,dest.push(form.tl.value))}),form.tl.addEventListener("input",()=>dest[0]=form.tl.value),form.target.addEventListener("input",()=>form.download.disabled=""===form.target.value.trim());